## ğŸ§© Feature 5 â€” Administration : Gestion des Ã©tablissements

### ğŸ¯ User Story

**Story 1.5.1 â€” Gestion des Ã©tablissements partenaires**
*En tant quâ€™administrateur Ã‰tapSup*,
*je veux* ajouter, modifier et consulter les Ã©tablissements partenaires avec leurs informations principales (localisation, spÃ©cialisation, frais, commission, etc.),
*afin de* centraliser toutes les donnÃ©es scolaires et les afficher correctement cÃ´tÃ© Ã©tudiant.

**CritÃ¨res dâ€™acceptation :**

* Page `/admin/etablissements` accessible uniquement Ã  lâ€™administrateur.
* Actions disponibles : **Ajouter**, **Modifier**, **Supprimer**, **Afficher**.
* Champs : Nom, Pays, Ville, Logo, Site web, SpÃ©cialisation, **Frais de dossier (unique)**, **Commission (%)**, **Acompte scolaritÃ© (Sprint 2)**.
* Fiche Ã©tablissement structurÃ©e en 5 onglets : PrÃ©sentation, PrÃ©requis, Conditions financiÃ¨res, Programmes, Campus.
* Synchronisation automatique avec la vue publique `/etablissements`.

### âš™ï¸ Prompt Claude â€“ ImplÃ©mentation (Sprint 1)

> **Mission globale :**
> Mettre Ã  jour la gestion des Ã©tablissements dans le back-office admin en **rÃ©utilisant les contrÃ´leurs, modÃ¨les et vues existants**.
> Avant toute action, **analyse la structure actuelle** du module, puis **Ã©tends-la** sans casser les routes ni la base.

#### ğŸ§  Analyse prÃ©alable de lâ€™existant

* Identifier :

  * `AdminEtablissements.vue` ou `EstablishmentsAdmin.vue`
  * `EstablishmentController`
  * `Establishment` modÃ¨le
  * Routes `GET /api/v1/establishments`, `POST /api/v1/establishments`
* VÃ©rifier lâ€™upload de logos (validation, taille).
* Diagnostic :

  ```bash
  // Diagnostic Sprint1 - Feature 1.5.1 :
  // Composant dÃ©tectÃ© : AdminEtablissements.vue
  // ContrÃ´leur : EstablishmentController (CRUD complet)
  // Champs manquants : frais_dossier, commission, acompte_scolarite
  // DÃ©cision : Ã©tendre formulaire + migration safe add columns
  ```

#### âš™ï¸ Ã‰tapes dâ€™implÃ©mentation

**A. Interface admin**

* `/admin/etablissements` :

  * Bouton `[Ajouter un Ã©tablissement]` â†’ modal ou page dÃ©diÃ©e.
  * Champs : Nom *, Pays *, Ville, Logo, Site web, SpÃ©cialisation, Frais de dossier, Commission, Acompte scolaritÃ©.
  * Actions : `[Modifier]`, `[Supprimer]`.
  * Recherche et pagination.

**B. Base de donnÃ©es**

* Ajouter migration non destructive :

  ```php
  Schema::table('establishments', function (Blueprint $table) {
      $table->decimal('frais_dossier', 10, 2)->nullable();
      $table->decimal('commission', 5, 2)->nullable();
      $table->decimal('acompte_scolarite', 10, 2)->nullable();
  });
  ```
* Aucun champ supprimÃ©.

**C. ContrÃ´leur**

* Ã‰tendre `EstablishmentController` :

  * Validation via Form Request.
  * Upload logo via logique existante.
  * Stockage simple des montants, pas de lien Stripe.

**D. Vue dÃ©tail**

* `EstablishmentDetail.vue` :

  * Onglets : PrÃ©sentation, PrÃ©requis, Conditions financiÃ¨res, Programmes, Campus.
  * Edition via textarea + bouton `[Enregistrer]`.

#### ğŸ¨ UX / UI

* Formulaires lisibles, boutons primaires uniformisÃ©s.
* Feedback visuel : â€œâœ… Ã‰tablissement mis Ã  jour avec succÃ¨sâ€.
* Design cohÃ©rent avec le dashboard admin.

#### ğŸ”’ SÃ©curitÃ©

* AccÃ¨s restreint (`isAdmin`).
* Validation image (jpg/png, â‰¤ 2 Mo).
* Aucune donnÃ©e sensible exposÃ©e.

#### âŒ Ã€ ne pas faire

* Ne pas crÃ©er de modÃ¨le â€œFormationâ€.
* Ne pas lier les commissions Ã  Stripe.
* Ne pas modifier les routes API.
* Ne pas supprimer de colonnes existantes.

#### ğŸ“˜ TraÃ§abilitÃ©

```js
// Sprint1 Update: Feature 1.5.1 â€” Administration : Gestion des Ã©tablissements (frais, commission, acompte)
```

`docs/qa/TEST_REPORT.md` â†’

```
Section â€œAdmin â€“ Ã‰tablissementsâ€ â€” VÃ©rifier crÃ©ation, Ã©dition, suppression, affichage nouveaux champs (frais, commission, acompte).
```
