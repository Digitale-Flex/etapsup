## ğŸ§© Feature 6 â€” Comptes & RÃ´les

### ğŸ¯ User Story

**Story 1.6.1 â€” Gestion des comptes utilisateurs (administration)**
*En tant quâ€™administrateur Ã‰tapSup*,
*je veux* visualiser et gÃ©rer les comptes utilisateurs (administrateurs, partenaires, gestionnaires),
*afin de* contrÃ´ler les accÃ¨s Ã  la plateforme tout en gardant une structure simple et Ã©volutive.

**CritÃ¨res dâ€™acceptation :**

* Une page `/admin/comptes` remplace lâ€™ancienne section â€œGestion des espacesâ€.
* Trois rÃ´les visibles : **Administrateur**, **Partenaire**, **Gestionnaire** (modÃ¨le Mareza).
* Chaque compte affiche : nom, email, rÃ´le, date dâ€™inscription.
* Les rÃ´les dÃ©terminent lâ€™accÃ¨s Ã  certaines sections (via middleware simple).
* Aucune gestion fine des permissions pour ce sprint (prÃ©vue Sprint 2).
* PossibilitÃ© dâ€™ajouter un utilisateur (admin uniquement).

### âš™ï¸ Prompt Claude â€“ ImplÃ©mentation (Sprint 1)

> **Mission globale :**
> Mettre Ã  jour la section de gestion des comptes pour afficher et gÃ©rer les 3 rÃ´les de base (`admin`, `partenaire`, `gestionnaire`),
> en **rÃ©utilisant le modÃ¨le `User` et la logique dâ€™accÃ¨s existante**.
> Avant modification, **analyse la gestion actuelle des utilisateurs et du middleware** pour tâ€™aligner sur la structure Mareza.

#### ğŸ§  Analyse prÃ©alable de lâ€™existant

* Identifier :

  * `AdminUsers.vue`, `GestionComptes.vue`, ou `UserList.vue`.
  * `UserController`, `AdminController`.
  * Routes `/api/v1/users`, `/api/v1/admin/users`.
* VÃ©rifier si un champ `role` ou `is_admin` existe dans `users`.
* Ã‰tudier le middleware dâ€™accÃ¨s (`isAdmin`).
* Diagnostic :

  ```bash
  // Diagnostic Sprint1 - Feature 1.6.1 :
  // Composant dÃ©tectÃ© : AdminUsers.vue
  // Champ existant : users.role
  // Middleware : isAdmin
  // DÃ©cision : activer 3 rÃ´les visibles, badges + middleware simple (isAdmin, isPartner, isManager)
  ```

#### âš™ï¸ Ã‰tapes dâ€™implÃ©mentation

**A. Interface admin**

* `/admin/comptes` :

  * Liste des utilisateurs avec : Nom, Email, RÃ´le, Date dâ€™inscription.
  * Badges de couleur :

    * ğŸŸ© Admin
    * ğŸŸ¦ Partenaire
    * ğŸŸ§ Gestionnaire
  * Bouton `[Ajouter un utilisateur]` (admin uniquement).
  * Modal dâ€™ajout : nom, email, rÃ´le, mot de passe temporaire.

**B. Backend**

* VÃ©rifier table `users` :

  * Si champ `role` manquant â†’ migration :

    ```php
    Schema::table('users', function (Blueprint $table) {
        $table->string('role')->default('user');
    });
    ```
* Mettre Ã  jour `UserController` pour inclure les rÃ´les dans la rÃ©ponse API.
* Middleware supplÃ©mentaires :

  ```php
  Route::middleware(['auth:sanctum', 'isAdmin'])->group(...);
  Route::middleware(['auth:sanctum', 'isPartner'])->group(...);
  Route::middleware(['auth:sanctum', 'isManager'])->group(...);
  ```

**C. RÃ¨gles dâ€™accÃ¨s**

* Admin â†’ accÃ¨s complet.
* Partenaire â†’ accÃ¨s aux candidatures liÃ©es Ã  son Ã©tablissement.
* Gestionnaire â†’ lecture des candidatures et mise Ã  jour de statut limitÃ©e.
* Routes protÃ©gÃ©es par vÃ©rification du rÃ´le.

#### ğŸ¨ UX / UI

* Design cohÃ©rent avec le dashboard admin.
* Badges colorÃ©s, boutons clairs.
* Message : â€œLes rÃ´les avancÃ©s (permissions dÃ©taillÃ©es) seront activÃ©s au prochain lot.â€

#### ğŸ”’ SÃ©curitÃ©

* Middleware obligatoires.
* Validation Ã  la crÃ©ation (`email`, `password`, `role`).
* Aucune suppression dâ€™utilisateurs sans confirmation.

#### âŒ Ã€ ne pas faire

* Ne pas intÃ©grer de librairie de permissions (`spatie/laravel-permission`).
* Ne pas modifier la structure dâ€™authentification.
* Ne pas activer de gestion fine des droits dans ce sprint.

#### ğŸ“˜ TraÃ§abilitÃ©

```js
// Sprint1 Update: Feature 1.6.1 â€” Comptes & RÃ´les (admin, partenaire, gestionnaire)
```

`docs/qa/TEST_REPORT.md` â†’

```
Section â€œAdmin â€“ Comptes & RÃ´lesâ€ â€” VÃ©rifier affichage des rÃ´les, badges, crÃ©ation utilisateur et restrictions dâ€™accÃ¨s.
``