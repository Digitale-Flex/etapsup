## üß© Feature 8 ‚Äî Dossier de candidature & pi√®ces justificatives

### üéØ User Story

**Story 1.8.1 ‚Äî Cr√©ation et soumission du dossier de candidature**
*En tant qu‚Äô√©tudiant (Amina)*,
*je veux* pouvoir compl√©ter un dossier de candidature √©tape par √©tape, t√©l√©verser mes pi√®ces et effectuer le paiement final,
*afin de* soumettre mon dossier complet √† l‚Äô√©tablissement choisi.

**Crit√®res d‚Äôacceptation :**

* Page `/candidature/nouvelle` disponible apr√®s connexion.
* Formulaire multi-√©tapes :

  1. Informations personnelles
  2. Choix de l‚Äô√©tablissement
  3. T√©l√©versement des pi√®ces justificatives
  4. Paiement (Stripe)
  5. Soumission finale
* Tous les champs marqu√©s `*` sont obligatoires.
* Soumission bloqu√©e si pi√®ces manquantes ou paiement non valid√©.
* L‚Äô√©tudiant peut pr√©visualiser et supprimer les fichiers avant soumission.
* Le statut du dossier passe √† ‚ÄúSoumis‚Äù apr√®s validation compl√®te.

### ‚öôÔ∏è Prompt Claude ‚Äì Impl√©mentation (Sprint 1)

> **Mission globale :**
> Mettre √† jour le module de candidature pour assurer le parcours complet de soumission, en **r√©utilisant la structure existante** (composants, contr√¥leurs et mod√®les).
> Avant toute modification, **analyse la logique actuelle** du multi-step form et de l‚Äôupload, puis **√©tends-la** pour y int√©grer les contr√¥les de paiement et de compl√©tude.

#### üß† Analyse pr√©alable de l‚Äôexistant

* Identifier :

  * Composant Vue : `ApplicationForm.vue`, `NewApplication.vue`, ou `CandidatureWizard.vue`.
  * Sous-composants : √©tapes Infos, √âtablissement, Documents, Paiement.
  * Contr√¥leur backend : `ApplicationController`.
  * Mod√®les : `Application`, `Document`, `User`, `Establishment`.
  * Routes API : `POST /api/v1/applications`, `POST /api/v1/documents`, `PATCH /api/v1/applications/{id}/status`.
* V√©rifier le workflow d‚Äô√©tapes et la gestion des fichiers existants.
* Diagnostic :

  ```bash
  // Diagnostic Sprint1 - Feature 1.8.1 :
  // Composant d√©tect√© : CandidatureWizard.vue
  // Backend : ApplicationController (store/update)
  // Upload : DocumentController
  // D√©cision : √©tendre workflow avec contr√¥le paiement + v√©rification pi√®ces
  ```

#### ‚öôÔ∏è √âtapes d‚Äôimpl√©mentation

**A. Formulaire multi-√©tapes**

* R√©utiliser le wizard existant.
* Ajouter v√©rification finale :

  * Si `documents.count < required` ‚Üí blocage.
  * Si `payment_status != 'paid'` ‚Üí blocage.
* Bouton `[Soumettre mon dossier]` ‚Üí `PATCH /api/v1/applications/{id}` (`status = 'Soumis'`).

**B. T√©l√©versement des pi√®ces**

* R√©utiliser `DocumentUploader.vue`.
* Formats autoris√©s : `.pdf`, `.jpg`, `.png`, max 10 Mo.
* Fonctions : `[Ajouter]`, `[Supprimer]`, `[Pr√©visualiser]`.
* Stocker m√©tadonn√©es dans `documents` : type, chemin, date.

**C. Backend**

* √âtendre `ApplicationController` :

  * M√©thode `submit()` v√©rifie pi√®ces + paiement avant validation.
  * Validation stricte via Form Request.
  * Pas de migration ni refonte structurelle.

#### üé® UX / UI

* Barre d‚Äôavancement visible, design √©pur√©.
* Couleurs diff√©renci√©es par √©tape.
* Messages :

  * ‚úÖ ‚ÄúVotre dossier est complet et soumis.‚Äù
  * ‚ö†Ô∏è ‚ÄúVeuillez t√©l√©verser toutes les pi√®ces et valider le paiement.‚Äù

#### üîí S√©curit√©

* Validation c√¥t√© serveur et client.
* Auth obligatoire (`auth:sanctum`).
* V√©rification MIME et taille fichiers.
* Acc√®s limit√© aux candidatures de l‚Äôutilisateur connect√©.

#### ‚ùå √Ä ne pas faire

* Ne pas cr√©er de table `submissions`.
* Ne pas modifier les relations existantes.
* Ne pas m√©langer upload et paiement dans le m√™me contr√¥leur.
* Ne pas activer les notifications automatiques (Sprint 2).

#### üìò Tra√ßabilit√©

```js
// Sprint1 Update: Feature 1.8.1 ‚Äî Dossier de candidature & pi√®ces justificatives
```

`docs/qa/TEST_REPORT.md` ‚Üí

```
Section ‚ÄúCandidature‚Äù ‚Äî V√©rifier progression √©tapes, blocage pi√®ces manquantes/paiement, soumission finale.
```
